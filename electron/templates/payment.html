 <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Payment</title>
</head>
<body>
<div>
    <h2>Confirm Payment</h2>
    <ul>
        {% for item in cart_items %}
            <li>{{ item.product.name }} - ₹{{ item.product.price }}</li>
        {% endfor %}
    </ul>
    <p>Total: ₹{{ order.total_price }}</p>
    <form id="payment-form" action="{% url 'payment' %}">
     
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<div class="container mt-5">
    <h2>Order Summary</h2>
    <p>Total Amount: ₹{{ total_price }}</p>
    <button id="rzp-button1" class="btn btn-primary">Pay with Razorpay</button>
</div>

<script>
var options = {
    "key": "{{ razorpay_merchant_key }}",
    "amount": "{{ razorpay_amount }}",
    "currency": "INR",
    "name": "Your Store Name",
    "description": "Order Payment",
    "order_id": "{{ razorpay_order_id }}",
    "handler": function (response) {
        // Send payment details to your server
        fetch('{{ callback_url }}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken')
            },
            body: JSON.stringify({
                razorpay_payment_id: response.razorpay_payment_id,
                razorpay_order_id: response.razorpay_order_id,
                razorpay_signature: response.razorpay_signature
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                window.location.href = "{% url 'payment_success' %}";
            } else {
                window.location.href = "{% url 'payment_failure' %}";
            }
        })
        .catch(error => {
            console.error('Error:', error);
            window.location.href = "{% url 'payment_failure' %}";
        });
    },
    "prefill": {
        "name": "{{ request.user.get_full_name }}",
        "email": "{{ request.user.email }}"
    },
    "theme": {
        "color": "#3399cc"
    }
};

function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

var rzp1 = new Razorpay(options);
document.getElementById('rzp-button1').onclick = function(e){
    rzp1.open();
    e.preventDefault();
}
</script>



</form>
</div>
</body>
</html> 





